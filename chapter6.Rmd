
## Analysis of longitudinal data

```{r}
date()
```
Before the analyses, I created a new R Markdown file, named it as 'chapter6.Rmd', and saved it to my folder. Then, I included the new file as a child file in my 'index.Rmd' file.

**FIRST, I implemented the analyses of Chapter 8 of MABS using the RATS data.**

```{r echo=FALSE}
library(readr)
RATSL <- read_csv("RATSL.csv")
RATSL$ID <- factor(RATSL$ID)
RATSL$Group <- factor(RATSL$Group)
summary(RATSL)
```
```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
ggplot(RATSL, aes(x = Time, y = Weight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(RATSL$Weight), max(RATSL$Weight)))
```

Individual response profiles of **non-standardized weights** by Group highlight differences across Groups. Weights of rats belonging to Group 1 are lower in general, also at baseline.

```{r}
RATSL <- RATSL %>%
  group_by(Group) %>%
  mutate(stdweight = (Weight - mean(Weight))/sd(Weight) ) %>%
  ungroup()
glimpse(RATSL)
ggplot(RATSL, aes(x = Time, y = stdweight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  scale_y_continuous(name = "Standardized Weight")
```

Individual response profiles of **standardized weights** emphasize differences across individuals.

```{r}
n <- 16
RATSS <- RATSL %>%
  group_by(Group, Time) %>%
  summarise( mean = mean(stdweight), se = sd(stdweight)/sqrt(n) ) %>%
  ungroup()
glimpse(RATSS)
ggplot(RATSS, aes(x = Time, y = mean, linetype = Group, shape = Group)) +
  geom_line() +
  scale_linetype_manual(values = c(1,2,3)) +
  geom_point(size=3) +
  scale_shape_manual(values = c(1,2,3)) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.1,0.8)) +
  scale_y_continuous(name = "Mean(StdWeight) +/- SE(StdWeight)")
```

Mean response profiles for the three treatment groups show no differences across diets with respect to standardized weight gain.

```{r}
RATSL8S <- RATSL %>%
  group_by(Group, ID) %>%
  summarise( mean=mean(stdweight) ) %>%
  ungroup()
glimpse(RATSL8S)
ggplot(RATSL8S, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "Mean(StdWeight), WD1-WD64")
```

Box plots of standardized mean summary weights by the three treatment groups suggest one outlier per Group.

```{r}
RATSL8S1 <- RATSL8S %>%
  filter(between(mean, -1, 1))
glimpse(RATSL8S1)
ggplot(RATSL8S1, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "Mean(StdWeight), WD1-WD64")
```

After removing the outliers, the box plots indicate differences across diets with respect to standardized weight gain. Group 2 has gained less weight.

```{r}
summary(aov(mean ~ Group, data = RATSL8S1, var.equal = TRUE))
```

One-Way ANOVA verifies the box plot; there is a statistically significant difference in weight gain across diets after removing three outliers. The test P-value for Group is ~0.010.

```{r}
RATS <- read_csv("RATS.csv")
RATSL8S2 <- RATSL8S %>%
  mutate(baseline = RATS$WD1)
fit <- lm(mean ~ baseline + Group, data = RATSL8S2)
anova(fit)
```

Using the first weight values (WD1) as covariates in the ANOVA does not change the interpretation. There still is a statistically significant difference in weight gain across diets. The test P-value for Group is ~0.002.
